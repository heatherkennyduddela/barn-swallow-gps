# barn-swallow-gps

This file contains details about the data processing and analysis for relating GPS movement data of female barn swallows to their extra-pair mating outcomes in terms of the proportion of extra-pair young in their clutch, and the number of sires represented in each clutch. 

The steps described require the following software: 

* R and RStudio

For details about processing genomic data and caclulating pairwise relatedness, see the README file in the `genomic-workflow` folder. 

## Contents

* [Process spatial data from GPS tags](#spatial-data)
* [Paternity assignment using relatedness](#paternity-assignment)
* [Hypothesis testing and models](#models)

### Processing GPS Data

Raw GPS data can be downloaded from MoveBank. The GPS data used for this projet and posted to this repository has been filtered to only include valid fixes and those with high horizontal accuracy (HDOP > 5). Raw data also includes a reference fix that was taken prior to deployment. Those reference points have been removed from the data provided here. Scripts and data are in the folder `process-spatial-data`.


Use the script `KDE with adehabitatHR` to calculate 50% and 90% kernel density estimator areas, and the proportion of points within 50 and 100m of the home barn. The script takes the following input data: 

* `GPS points all sites.csv` table of GPS points for each female
* `barns.csv` table of nesting barn locations


Use the script `est-max-dist.R` to calculate the estimated maximum distance traveled from the nesting barn for each bird. This script downsamples to the fewest number of GPS points per bird (60), and repeatedly takes random samples of 60 points for each bird to calculate the estimated maximum distance. This helps account for uneven sampling across birds. The final distance estimates are the average for each bird across 100 replicats. This script takes the following input data: 

* `point.distance.hkd.csv` generated by the `KDE with adehabitatHR.R` script


### Paternity assignment using relatedness

We use pairwise relatedness values from the program lcMLkin to assign genetic sires. For details of the relatedness calculations using low-coverage whole-genome sequences, see the README file in the `genomic-workflow` folder. Unlike other paternity assignment programs, we do not need to provied any a priori information about known mother-offspring relationships. We validated the parentage assignment workflow by using relatedness values to identify genetic mother-offspring relationships. In alls cases, the assigned mother matched the known social mother identified by observations at the nest. Therefore, we are confident that genetic sire assignments are reliable. Scripts and input data are in the `paternity-assignment` folder. 

Use the script `paternity 2021 assignment with lcMLkin output.R` to identify genetic dams and genetic sires. We then uses those assignments to calculate the proportion of extra-pair offspring in each clutch and for each female over the course of the whole breeding season. Finally, we calculate the total number of extra-pair sires for each clutch and for each female over the course of the breeding season. This script takes the following input files: 

* `CO-2021.thin10k.GL-recalculate` output file from lcMLkin
* `fam_clutch21_updated broods.csv` table of known social relationships


### Hypothesis testing and models








