# barn-swallow-gps

This file contains details about the data processing and analysis for relating GPS movement data of female barn swallows to their extra-pair mating outcomes in terms of the proportion of extra-pair offspring, number of extra-pair offspring, and number of sires represented in each clutch. 

These results are published in the article title "Female Space Use and Plumage Colour Correlate with Extra-pair Mating in Barn Swallow Replacement Clutches". 
Article authors: Heather V. Kenny-Duddela, Drew R. Schield, Kayleigh P. Keller, Rebecca J. Safran

The steps described require the following software: 

* R and RStudio

For details about processing genomic data and caclulating pairwise relatedness, see the README file in the `genomic-workflow` folder. 

## Contents

* [Process spatial data from GPS tags](#processing-gps-data)
* [Paternity assignment using relatedness](#paternity-assignment-using-relatedness)
* [Make data table for models](#make-data-table-for-models)
* [Models for replacement clutch](#models-for-replacement-clutch)
* [Models for change in paternity](#models-for-change-in-paternity)

### Processing GPS Data

Raw GPS data can be downloaded from MoveBank. The GPS data used for this projet and posted to this repository has been filtered to only include valid fixes and those with high horizontal accuracy (HDOP > 5). Raw data also includes a reference fix that was taken prior to deployment. Those reference points have been removed from the data provided here. Scripts and data are in the folder `process-spatial-data`.


Use the script `KDE with adehabitatHR_git.R` to calculate 50% and 90% kernel density estimator areas, and the proportion of points within 50 and 100m of the home barn. The script takes the following input data: 

* `GPS points all sites.csv` table of GPS points for each female
* `Barn where tags were deployed 2021.csv` table of nesting barn locations

This script produces the fillowing figures reported in the manuscript: 

* Figure 1
* Figure S2


Use the script `est-max-dist.R` to calculate the estimated maximum distance traveled from the nesting barn for each bird. This script downsamples to the fewest number of GPS points per bird (60), and repeatedly takes random samples of 60 points for each bird to calculate the estimated maximum distance. This helps account for uneven sampling across birds. The final distance estimates are the average for each bird across 100 replicats. This script takes the following input data: 

* `point.distance.hkd.csv` generated by the `KDE with adehabitatHR_git.R` script

[back to top](#barn-swallow-gps)


### Paternity assignment using relatedness

We use pairwise relatedness values from the program [lcMLkin](https://github.com/COMBINE-lab/maximum-likelihood-relatedness-estimation?tab=readme-ov-file) to assign genetic sires. For details of the relatedness calculations using low-coverage whole-genome sequences, see the README file in the `genomic-workflow` folder. Unlike other paternity assignment programs, we do not need to provied any a priori information about known mother-offspring relationships. We validated the parentage assignment workflow by using relatedness values to identify genetic mother-offspring relationships. In alls cases, the assigned mother matched the known social mother identified by observations at the nest. Therefore, we are confident that genetic sire assignments are reliable. Scripts and input data are in the `paternity-assignment` folder. 

Use the script `paternity 2021 assignment with lcMLkin output.R` to identify genetic dams and genetic sires. We then uses those assignments to calculate the proportion of extra-pair offspring in each clutch and for each female over the course of the whole breeding season. Finally, we calculate the total number of extra-pair sires for each clutch and for each female over the course of the breeding season. This script takes the following input files: 

* `CO-2021.thin10k.GL-recalculate` output file from lcMLkin
* `fam_clutch21_updated broods.csv` table of known social relationships

[back to top](#barn-swallow-gps)


### Make data table for models

To make the data table used in modeling, use the script `make table and exploratory figs.R` This script takes the following input data: 

* `fert_2021_by_clutchID.csv` generated in the paternity assignment step
* `KDE probs_updated.csv` generated in the spatial data processing step
* `num mates chicks clutches per female 2021.csv` generated in the paternity assignment step
* `num mates replacement clutch.csv` generated in the paternity assignment step
* `num mates collected clutch.csv` generated in the paternity assignment step
* `plumage-color-mass.csv` belly average brightness for females and males, and female mass
* `estimated max distance from resampling_original.csv` generated in the spatial data processing step

This script generates the following results reported in the manuscript: 

* Figure S1
* Figures S2 panels a-d

[back to top](#barn-swallow-gps)


### Models for replacement clutch

To fit models of extra-pair mating in the replacement clutch, use the script `models replacement clutch.R` This script takes the following input data: 

* `table for movement and mating models_BES.csv` generated in the make table for models step. 

This script generates the following results reported in the manuscript: 

* Figure 2 panels a and b
* Figure S6
* Figure S7
* Model AIC tables S6-S8

[back to top](#barn-swallow-gps)


### Models for change in paternity

To fit models for the change in extra-pair mating between successive clutches, use the script `change in paternity models.R`. This script takes the following input data: 

* `table for movement and mating models_BES.csv` generated in the make table for models step.

[back to top](#barn-swallow-gps)
